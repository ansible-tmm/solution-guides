
# AI Infrastructure Automation with Ansible – Solution Guide

## Table of Contents

- [Overview](#overview)
- [Solution Components](#solution-components)
- [How to Download These Collections](#how-to-download-these-collections)
  - [Configure Ansible to Load Local Collections](#configure-ansible-to-load-local-collections)
- [AWS AMI Setup for RHEL AI](#aws-ami-setup-for-rhel-ai)
  - [Option 1: Subscribe via AWS Marketplace](#option-1-subscribe-via-aws-marketplace)
  - [Option 2: Create Your Own AMI](#option-2-create-your-own-ami)
- [Setting Up Inventory File](#setting-up-inventory-file)
- [Playbooks Included in the Collections](#playbooks-included-in-the-collections)
  - [1. provision.yml (`infra.ai`)](#1-provisionyml-infraai)
  - [2. ilab.yml (`redhat.ai`)](#2-ilabyml-redhatai)
- [Pulling Sample Vars and Playbook Files](#pulling-sample-vars-and-playbook-files)
- [Variable Configuration](#variable-configuration)
- [Validating Model Deployment](#validating-model-deployment)
- [Integration with Ansible Lightspeed](#integration-with-ansible-lightspeed)
- [Final Notes](#final-notes)
- [Sources](#sources)

## Overview

This solution guide helps Ansible Automation Platform (AAP) customers automate the deployment and configuration of **RHEL AI** on **AWS** using two key Ansible collections:

- **Validated Collection**: [**infra.ai**](https://console.redhat.com/ansible/automation-hub/repo/validated/infra/ai) – Provisions RHEL AI infrastructure.
- **Certified Collection**: [**redhat.ai**](https://console.redhat.com/ansible/automation-hub/repo/published/redhat/ai) – Configures and serves an AI model on a provisioned RHEL AI host using InstructLab.

## Solution Components

The solution leverages:

- **infra.ai** for infrastructure provisioning:
  - EC2 Instances
  - VPC
  - Subnets
  - Security Groups

- **redhat.ai** for model serving:
  - InstructLab configuration
  - Model deployment and validation

## How to Download These Collections

Install the collections directly from Automation Hub:

```bash
ansible-galaxy collection install infra.ai
ansible-galaxy collection install redhat.ai
```

[Installing Ansible Collections – Documentation](https://docs.ansible.com/ansible/latest/collections_guide/collections_installing.html)

### Configure Ansible to Load Local Collections

Update your `ansible.cfg` file in your local playbook project to prioritize locally installed collections:

```ini
[defaults]
collections_paths = ./collections:~/.ansible/collections:/usr/share/ansible/collections
```

## AWS AMI Setup for RHEL AI

Provisioning requires an AMI ID for RHEL AI. Obtain it using one of these two methods:

### Option 1: Subscribe via AWS Marketplace

- Visit [Red Hat RHEL AI on AWS Marketplace](https://aws.amazon.com/marketplace).
- Subscribe to the RHEL AI AMI.
- Retrieve the AMI ID from your AWS Console in your selected region.

[Detailed instructions for subscribing and retrieving AMI ID](https://docs.aws.amazon.com/marketplace/latest/userguide/subscribe-to-ami.html)

### Option 2: Create Your Own AMI

- Install and configure RHEL AI manually on a supported base AWS image.
- Save your configured instance as an AMI.
- Note the AMI ID generated by AWS.

Pass the obtained AMI ID into your playbook using the variable:

```yaml
rhelai_aws_rhelai_ami: ami-xxxxxxxxxxxxxxxxx
```

## Setting Up Inventory File

After provisioning the AWS instance, create an inventory file with the IP address and the private key. You will use this inventory group with the `provision.yml` playbook to configure InstructLab on your newly provisioned AWS instance.

Example inventory file:

```ini
[rhelai_servers]
<instance_ip> ansible_user=ec2-user ansible_ssh_private_key_file=~/.ssh/your_private_key.pem
```

You can run the provisioning and configuration through the Ansible Automation Controller within AAP for a streamlined workflow.

## Playbooks Included in the Collections

### 1. provision.yml (`infra.ai`)

This playbook automates infrastructure provisioning:

- Sets up AWS credentials.
- Creates a key pair.
- Provisions networking (VPC, Subnets, Security Groups).
- Launches EC2 instance with RHEL AI AMI.

### 2. ilab.yml (`redhat.ai`)

This playbook configures and serves your AI model:

- Installs and configures InstructLab.
- Downloads the required AI model.
- Starts and validates the model server.

These playbooks work sequentially to provision infrastructure and serve an AI model quickly and efficiently.

## Pulling Sample Vars and Playbook Files

You can obtain the `sample_vars.yml`, `provision.yml`, and `ilab.yml` files directly from their respective collections:

```bash
ansible-galaxy collection install infra.ai --force
ansible-galaxy collection install redhat.ai --force
```

These files are typically available in the installed collections directory:

- `~/.ansible/collections/ansible_collections/infra/ai/playbooks/`
- `~/.ansible/collections/ansible_collections/redhat/ai/playbooks/`

## Variable Configuration

All required variables for these playbooks are pre-defined in `sample_vars.yml`. Ensure this file is correctly populated to match your specific setup.

## Validating Model Deployment

Verify if the model is running and responding to inference requests using a curl request:

```bash
curl -X POST http://<instance_ip>:<port>/v1/completions   -H 'Content-Type: application/json'   -d '{"prompt": "What is the capital of France?", "max_tokens": 10}'
```

Successful responses indicate the model is operational and ready for use.

## Integration with Ansible Lightspeed

Once validated, integrate your deployed LLM details into the Ansible Lightspeed intelligent assistant on AAP for efficient use across automation workflows.

## Final Notes

- This automation setup supports demonstration scenarios and production deployments.
- Future updates will support Azure, GCP, and OpenShift.

## Sources

- [Red Hat Ansible Automation Platform](https://www.redhat.com/en/technologies/management/ansible)
